# üõ£Ô∏è Roadmap de Desenvolvimento - Detector de Bocejo

Este documento orienta o desenvolvimento completo do aplicativo mobile de detec√ß√£o de bocejo, seguindo os padr√µes e arquitetura definidos no projeto.

## üöÄ **RESUMO EXECUTIVO**

### üìä **Status Atual:**
‚úÖ **Projeto Funcional** - Roda via `npm start` + Expo Go
‚úÖ **Base T√©cnica S√≥lida** - TypeScript, ESLint, Prettier configurados  
‚úÖ **Arquitetura Definida** - Estrutura de pastas e tipagens criadas
‚úÖ **Depend√™ncias Instaladas** - Supabase, MediaPipe, Camera prontos

### üéØ **Pr√≥ximo Passo:** 
**Fase 2 - Autentica√ß√£o e Supabase** ‚Äî Em andamento (cliente precisa configurar Supabase)

### üì± **Como Testar Agora:**
```bash
npm start  # Inicia o servidor Expo
# Escaneie QR Code com Expo Go no celular
```

### üõ†Ô∏è **Tecnologias Configuradas:**
- **React Native** + Expo 53.0.20
- **TypeScript** (strict mode)
- **Supabase** 2.53.0 (auth + database + storage)
- **MediaPipe** 0.6.0 (detec√ß√£o facial)
- **Expo Camera** 16.1.11 (acesso √† c√¢mera)

## üìã Status Geral
- [x] **Fase 1**: Configura√ß√£o Base e Estrutura ‚úÖ **COMPLETA**
- [x] **Fase 2**: Autentica√ß√£o e Supabase üéØ **EM DESENVOLVIMENTO**
- [ ] **Fase 3**: MediaPipe e C√¢mera
- [ ] **Fase 4**: Detec√ß√£o de Bocejo
- [ ] **Fase 5**: Storage e Sincroniza√ß√£o
- [ ] **Fase 6**: UI/UX e Relat√≥rios
- [ ] **Fase 7**: Testes e Otimiza√ß√£o

## üéØ **Progresso Atual:**
```
‚úÖ FASE 1 (100%) - Configura√ß√£o Base
   ‚îú‚îÄ‚îÄ ‚úÖ Expo 53.0.20 configurado
   ‚îú‚îÄ‚îÄ ‚úÖ Depend√™ncias instaladas (Supabase, MediaPipe, etc.)
   ‚îú‚îÄ‚îÄ ‚úÖ TypeScript strict + ESLint v9 + Prettier
   ‚îú‚îÄ‚îÄ ‚úÖ Estrutura de pastas criada
   ‚îú‚îÄ‚îÄ ‚úÖ Permiss√µes de c√¢mera configuradas
   ‚îî‚îÄ‚îÄ ‚úÖ Projeto test√°vel via Expo Go

üöß FASE 2 (100%) - Autentica√ß√£o
   ‚îú‚îÄ‚îÄ ‚úÖ Cliente Supabase configurado (AsyncStorage, refresh, persist√™ncia)
   ‚îú‚îÄ‚îÄ ‚úÖ Servi√ßos de Auth (signIn/signUp/signOut/onAuthStateChange)
   ‚îú‚îÄ‚îÄ ‚úÖ Contexto global de Auth (persist√™ncia de sess√£o)
   ‚îú‚îÄ‚îÄ ‚úÖ Telas de Login e Cadastro (valida√ß√µes b√°sicas)
   ‚îú‚îÄ‚îÄ ‚úÖ Tela Home p√≥s-login com bot√£o Sair (placeholder de menu)
   ‚îú‚îÄ‚îÄ ‚úÖ Guia completo de configura√ß√£o do Supabase (README)
   ‚îú‚îÄ‚îÄ ‚úÖ Criar projeto no Supabase (cliente)
   ‚îú‚îÄ‚îÄ ‚úÖ Tabela `yawn_events` + RLS (cliente)
   ‚îî‚îÄ‚îÄ ‚úÖ Bucket `yawn-images` (cliente)
```

---

## üöÄ **FASE 1: Configura√ß√£o Base e Estrutura** ‚úÖ **COMPLETA**

### 1.1 Setup do Projeto ‚úÖ
- [x] **Expo configurado** (SDK 53.0.20 com newArchEnabled)
- [x] **Depend√™ncias principais instaladas:**
  - [x] `react-native-mediapipe@0.6.0` ‚úÖ
  - [x] `@supabase/supabase-js@2.53.0` ‚úÖ
  - [x] `expo-camera@16.1.11` ‚úÖ
  - [x] `@react-native-async-storage/async-storage@2.2.0` ‚úÖ
  - [x] `react-native-fs@2.20.0` ‚úÖ
  - [x] `expo-av@15.1.7` (para recursos de m√≠dia) ‚úÖ
- [x] **TypeScript strict mode** configurado ‚úÖ
- [x] **ESLint v9 + Prettier** configurados ‚úÖ

### 1.2 Estrutura de Pastas ‚úÖ
- [x] **Estrutura completa criada:**
  ```
  ‚úÖ /app/                 ‚Üí Navega√ß√£o principal
  ‚úÖ /components/          ‚Üí Componentes reutiliz√°veis
  ‚úÖ /screens/            ‚Üí Telas principais
  ‚úÖ /services/
    ‚úÖ /api/              ‚Üí APIs externas
    ‚úÖ /supabase/         ‚Üí Integra√ß√£o Supabase
  ‚úÖ /lib/
    ‚úÖ /mediapipe/        ‚Üí Configura√ß√£o MediaPipe
    ‚úÖ /utils/            ‚Üí Fun√ß√µes utilit√°rias
  ‚úÖ /store/              ‚Üí Context API (Auth, Session)
  ‚úÖ /assets/             ‚Üí Recursos est√°ticos (existente)
  ‚úÖ /types/              ‚Üí Tipagens TypeScript
  ```

### 1.3 Configura√ß√£o de Ambiente ‚úÖ
- [x] **`.env` criado** com vari√°veis do Supabase e API externa ‚úÖ
- [x] **`app.json` atualizado** com:
  - [x] Permiss√µes de c√¢mera (iOS/Android) ‚úÖ
  - [x] Nome do app: "Yawn Detector" ‚úÖ
  - [x] Platforms: iOS, Android ‚úÖ
  - [x] Permiss√µes: CAMERA, STORAGE ‚úÖ
- [x] **Scripts npm adicionados** (lint, format, type-check) ‚úÖ

### 1.4 Arquivos Base Criados ‚úÖ
- [x] **`types/index.ts`** - Tipagens globais (User, YawnEvent, FaceLandmarks, etc.) ‚úÖ
- [x] **`lib/utils/index.ts`** - Fun√ß√µes utilit√°rias base ‚úÖ
- [x] **`components/index.ts`** - Arquivo de exporta√ß√£o ‚úÖ
- [x] **`screens/index.ts`** - Arquivo de exporta√ß√£o ‚úÖ
- [x] **`.env.example`** - Template de vari√°veis de ambiente ‚úÖ

### 1.5 Verifica√ß√µes de Qualidade ‚úÖ
- [x] **TypeScript:** 0 erros (npm run type-check) ‚úÖ
- [x] **ESLint:** Apenas 1 warning aceit√°vel ‚úÖ
- [x] **Prettier:** Formata√ß√£o consistente ‚úÖ
- [x] **Expo Start:** Projeto inicializa sem erros ‚úÖ

### üß™ **Como Testar a Fase 1:**
```bash
# Verificar TypeScript
npm run type-check

# Verificar ESLint
npm run lint

# Iniciar o projeto
npm start
# Escaneie o QR Code com Expo Go no celular
```

---

## üîê **FASE 2: Autentica√ß√£o e Supabase** üéØ **PR√ìXIMA**

> **Depend√™ncias:** `@supabase/supabase-js@2.53.0` ‚úÖ j√° instalada

### 2.1 Configura√ß√£o do Supabase üéØ
- [x] **Criar projeto no Supabase** ([supabase.com](https://supabase.com))
- [x] **Configurar autentica√ß√£o:**
  - [x] Email/senha habilitado
  - [x] Confirma√ß√£o por email (opcional)
  - [x] Configurar templates de email
- [x] **Criar tabela `yawn_events`:**
  ```sql
  CREATE TABLE yawn_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    timestamp TIMESTAMPTZ NOT NULL,
    image_url TEXT,
    keypoints JSONB NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
  );
  ```
- [x] **Configurar RLS (Row Level Security):**
  ```sql
  ALTER TABLE yawn_events ENABLE ROW LEVEL SECURITY;
  
  CREATE POLICY "Users can view own yawn events" ON yawn_events
    FOR SELECT USING (auth.uid() = user_id);
  
  CREATE POLICY "Users can insert own yawn events" ON yawn_events
    FOR INSERT WITH CHECK (auth.uid() = user_id);
  ```
- [x] **Criar bucket `yawn-images` no Storage** (p√∫blico para leitura)
- [x] **Atualizar `.env`** com credenciais reais do Supabase

### 2.2 Configura√ß√£o do Cliente Supabase üéØ
- [x] **`services/supabase/client.ts`** - Cliente configurado:
  ```typescript
  const supabaseConfig = {
    url: process.env.EXPO_PUBLIC_SUPABASE_URL!,
    anonKey: process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!,
    auth: {
      storage: AsyncStorage,
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: false
    }
  };
  ```
- [x] **`services/supabase/authService.ts`** - Abstra√ß√£o de auth
- [x] **`services/supabase/yawnEventService.ts`** - CRUD de eventos (b√°sico)

### 2.3 Context de Autentica√ß√£o üéØ
- [x] **`store/AuthContext.tsx`** - Context global:
  ```typescript
  interface AuthContextType {
    user: User | null;
    session: Session | null;
    signIn: (email: string, password: string) => Promise<void>;
    signUp: (email: string, password: string) => Promise<void>;
    signOut: () => Promise<void>;
    loading: boolean;
  }
  ```
- [x] **Integra√ß√£o com AsyncStorage** para cache de sess√£o
- [x] **Auto-refresh de tokens** configurado
- [x] **Tratamento de erros** gracioso

### 2.4 Telas de Autentica√ß√£o üéØ
- [x] **`screens/auth/LoginScreen.tsx`** - Tela de login
- [x] **`screens/auth/RegisterScreen.tsx`** - Tela de cadastro
- [x] **Tela Home p√≥s-login** (`screens/home/HomeScreen.tsx`) com bot√£o Sair
- [ ] **`components/AuthForm.tsx`** - Formul√°rio reutiliz√°vel (opcional)
  - [x] Valida√ß√£o de email/senha b√°sica
  - [x] Estados de loading
  - [x] Exibi√ß√£o de erros
- [ ] **Navega√ß√£o entre telas** (React Navigation)
- [x] **Prote√ß√£o de rotas** (condicional por sess√£o)

---

## üì± **FASE 3: MediaPipe e C√¢mera**

### 3.1 Configura√ß√£o do MediaPipe
- [ ] `lib/mediapipe/config.ts` - Configura√ß√£o base:
  ```typescript
  const mediapipeConfig = {
    runningMode: 'VIDEO',
    maxNumFaces: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.5
  };
  ```
- [ ] `lib/mediapipe/faceDetector.ts` - Wrapper do face detection
- [ ] `lib/mediapipe/landmarkExtractor.ts` - Extra√ß√£o de keypoints

### 3.2 Componente de C√¢mera
- [ ] `components/CameraView.tsx` - Componente principal da c√¢mera
- [ ] Implementar:
  - [ ] Verifica√ß√£o de permiss√µes
  - [ ] Inicializa√ß√£o da c√¢mera frontal
  - [ ] Resolu√ß√£o 640x480
  - [ ] Throttling (processar 1 de cada 10 frames)

### 3.3 Processamento de Frames
- [ ] `lib/mediapipe/frameProcessor.ts` - Processamento em background
- [ ] `types/mediapipe.ts` - Tipagens para landmarks
- [ ] Implementar:
  - [ ] Extra√ß√£o de keypoints faciais (468 pontos)
  - [ ] C√°lculo da raz√£o de aspecto da boca
  - [ ] Detec√ß√£o de confian√ßa > 0.7

---

## üéØ **FASE 4: Detec√ß√£o de Bocejo**

### 4.1 L√≥gica de Detec√ß√£o
- [ ] `lib/utils/yawnDetector.ts` - Algoritmo de detec√ß√£o:
  - [ ] Keypoints da boca (√≠ndices 0, 17, 18, 200)
  - [ ] C√°lculo: altura_boca / largura_boca
  - [ ] Threshold: raz√£o > 0.6 = poss√≠vel bocejo
  - [ ] Valida√ß√£o: 3+ frames consecutivos

### 4.2 API Externa
- [ ] `services/api/yawnAnalysisApi.ts` - Integra√ß√£o com API externa
- [ ] Implementar:
  - [ ] `POST /api/analyze-yawn`
  - [ ] Rate limit: m√°ximo 6 req/min
  - [ ] Timeout: 5s por request
  - [ ] Retry com exponential backoff (3 tentativas)

### 4.3 Gerenciamento de Sess√£o
- [ ] `store/SessionContext.tsx` - Context da sess√£o de detec√ß√£o
- [ ] `services/sessionService.ts` - L√≥gica da sess√£o
- [ ] Implementar:
  - [ ] Controle de in√≠cio/fim de sess√£o
  - [ ] Contagem de bocejos
  - [ ] C√°lculo de frequ√™ncia (bocejos/hora)
  - [ ] Estat√≠sticas em tempo real

---

## üíæ **FASE 5: Storage e Sincroniza√ß√£o**

### 5.1 Armazenamento de Eventos
- [ ] `services/supabase/yawnEventService.ts` - CRUD de eventos
- [ ] Implementar:
  - [ ] Captura de imagem no momento do bocejo
  - [ ] Compress√£o de imagem (70% qualidade)
  - [ ] Upload para Supabase Storage
  - [ ] Insert no banco com transa√ß√£o

### 5.2 Suporte Offline
- [ ] `services/offline/queueService.ts` - Fila local de eventos
- [ ] `services/offline/syncService.ts` - Sincroniza√ß√£o autom√°tica
- [ ] Implementar:
  - [ ] Cache local com AsyncStorage
  - [ ] Detec√ß√£o de status de rede
  - [ ] Sync autom√°tico quando online
  - [ ] Resolu√ß√£o de conflitos por timestamp

### 5.3 Gerenciamento de Storage
- [ ] `lib/utils/storageManager.ts` - Limpeza autom√°tica
- [ ] Implementar:
  - [ ] Remo√ß√£o de imagens antigas (> 30 dias)
  - [ ] Monitoramento de espa√ßo dispon√≠vel
  - [ ] Alertas de storage cheio

---

## üé® **FASE 6: UI/UX e Relat√≥rios**

### 6.1 Tela Principal de Detec√ß√£o
- [ ] `screens/DetectionScreen.tsx` - Tela principal
- [ ] Componentes:
  - [ ] Preview da c√¢mera
  - [ ] Contador de bocejos da sess√£o
  - [ ] Indicador de status da detec√ß√£o
  - [ ] Bot√µes iniciar/parar sess√£o

### 6.2 Feedback Visual
- [ ] `components/DetectionFeedback.tsx` - Indicadores visuais
- [ ] Implementar:
  - [ ] Loading durante processamento
  - [ ] Indicador de bocejo detectado
  - [ ] Vibra√ß√£o sutil (configur√°vel)
  - [ ] Overlay com keypoints faciais (debug)

### 6.3 Relat√≥rios e Hist√≥rico
- [ ] `screens/ReportScreen.tsx` - Relat√≥rios de sess√£o
- [ ] `screens/HistoryScreen.tsx` - Hist√≥rico de sess√µes
- [ ] `components/SessionCard.tsx` - Card de sess√£o
- [ ] Implementar:
  - [ ] Gr√°ficos de frequ√™ncia
  - [ ] Galeria de imagens capturadas
  - [ ] Estat√≠sticas detalhadas
  - [ ] Exporta√ß√£o de dados

### 6.4 Configura√ß√µes
- [ ] `screens/SettingsScreen.tsx` - Configura√ß√µes do app
- [ ] Implementar:
  - [ ] Sensibilidade de detec√ß√£o
  - [ ] Frequ√™ncia de an√°lise
  - [ ] Toggle vibra√ß√£o
  - [ ] Modo offline
  - [ ] Limpeza de dados

---

## üß™ **FASE 7: Testes e Otimiza√ß√£o**

### 7.1 Testes Unit√°rios
- [ ] Configurar Jest e React Native Testing Library
- [ ] Testes para:
  - [ ] Utilit√°rios de detec√ß√£o de bocejo
  - [ ] Servi√ßos de API
  - [ ] Context providers
  - [ ] Hooks customizados

### 7.2 Testes de Integra√ß√£o
- [ ] Testes E2E com Detox
- [ ] Fluxos principais:
  - [ ] Login ‚Üí Detec√ß√£o ‚Üí Salvamento
  - [ ] Offline ‚Üí Online ‚Üí Sincroniza√ß√£o
  - [ ] Gera√ß√£o de relat√≥rios

### 7.3 Otimiza√ß√£o de Performance
- [ ] Profiling com Flipper
- [ ] Otimiza√ß√µes:
  - [ ] Memory leaks em useEffect
  - [ ] Throttling de processamento
  - [ ] Lazy loading de componentes
  - [ ] Otimiza√ß√£o de imagens

### 7.4 Build e Deploy
- [ ] Configurar CI/CD
- [ ] Build para Android:
  - [ ] APK de desenvolvimento
  - [ ] Bundle para Play Store
- [ ] Build para iOS:
  - [ ] IPA de desenvolvimento
  - [ ] Build para App Store

---

## üéØ **Crit√©rios de Aceite por Fase**

### ‚úÖ Fase 1 Completa quando: ‚úÖ **REALIZADA**
- [x] Projeto roda no simulador/dispositivo ‚úÖ
- [x] Estrutura de pastas criada ‚úÖ
- [x] TypeScript configurado sem erros ‚úÖ
- [x] **ADICIONAL:** ESLint/Prettier configurados ‚úÖ
- [x] **ADICIONAL:** Depend√™ncias principais instaladas ‚úÖ
- [x] **ADICIONAL:** Permiss√µes de c√¢mera configuradas ‚úÖ

### ‚úÖ Fase 2 Completa quando:
- [x] **Projeto Supabase criado** e configurado
- [x] **Tabela yawn_events** criada com RLS
- [x] **Storage bucket** configurado
- [x] **Login/logout funcionando** com valida√ß√£o
- [x] **Sess√£o persistida** via AsyncStorage
- [x] **Context de autentica√ß√£o** funcionando
- [x] **Telas de auth** navegando corretamente
- [x] **Prote√ß√£o de rotas** implementada

### üß™ **Como Testar a Fase 2:**
```bash
# 1. Configurar .env com credenciais reais do Supabase
# 2. Testar autentica√ß√£o
npm start
# 3. Testar fluxos:
#    - Cadastro de novo usu√°rio
#    - Login com usu√°rio existente
#    - Logout
#    - Persist√™ncia de sess√£o (fechar e abrir app)
```

### ‚úÖ Fase 3 Completa quando:
- C√¢mera inicializa corretamente
- MediaPipe detecta rosto
- Keypoints s√£o extra√≠dos

### ‚úÖ Fase 4 Completa quando:
- Bocejo √© detectado localmente
- API externa responde corretamente
- Sess√£o rastreia eventos

### ‚úÖ Fase 5 Completa quando:
- Imagens s√£o salvas no Supabase
- Modo offline funciona
- Sincroniza√ß√£o autom√°tica

### ‚úÖ Fase 6 Completa quando:
- UI intuitiva e responsiva
- Relat√≥rios s√£o gerados
- Configura√ß√µes funcionam

### ‚úÖ Fase 7 Completa quando:
- Testes passando
- Performance otimizada
- Builds funcionando

---

## üìö **Recursos e Refer√™ncias**

- [Expo Documentation](https://docs.expo.dev/)
- [React Native MediaPipe](https://github.com/cdiddy77/react-native-mediapipe)
- [Supabase React Native Guide](https://supabase.com/docs/guides/getting-started/tutorials/with-react-native)
- [Face Landmarks Reference](https://github.com/google/mediapipe/blob/master/docs/solutions/face_mesh.md)

---

## üìù **Changelog & Controle de Vers√£o**

### **v1.2 - Fase 2 (parcial) - Autentica√ß√£o** (Data: Atual)
#### ‚úÖ **Adicionado:**
- Cliente Supabase com persist√™ncia e auto-refresh
- Servi√ßos de autentica√ß√£o e eventos (b√°sico)
- Contexto global de Auth + persist√™ncia de sess√£o
- Telas de Login e Cadastro com valida√ß√µes
- Tela Home com menu (placeholders) e bot√£o Sair
- Guia completo de configura√ß√£o do Supabase no README

#### ‚è≥ **Pendente (cliente):**
- Criar projeto Supabase, tabela `yawn_events` + RLS, bucket `yawn-images`

#### üéØ **Pr√≥xima Vers√£o (v1.3):**
- Integra√ß√£o MediaPipe (Fase 3) + Componente de c√¢mera
- React Navigation com tabs (Detec√ß√£o, Hist√≥rico, Perfil)

### **v1.1 - Fase 1 Implementada** (Hist√≥rico)

### **v1.0 - Setup Inicial** 
- Projeto criado com Expo
- Depend√™ncias b√°sicas do React Native
- Estrutura inicial do projeto

---

## üéØ **M√©tricas de Progresso**

```
üìä PROGRESSO GERAL: 21.4% (1.5/7 fases)

‚úÖ FASE 1: 100% - Configura√ß√£o Base
üöß FASE 2:  60% - Autentica√ß√£o e Supabase  
‚è≥ FASE 3:   0% - MediaPipe e C√¢mera
‚è≥ FASE 4:   0% - Detec√ß√£o de Bocejo
‚è≥ FASE 5:   0% - Storage e Sincroniza√ß√£o
‚è≥ FASE 6:   0% - UI/UX e Relat√≥rios
‚è≥ FASE 7:   0% - Testes e Otimiza√ß√£o
```

**üìÖ Estimativa de Conclus√£o:** 7-10 semanas (1-2 semanas por fase)

---

**‚ö†Ô∏è Lembretes Importantes:**
- Sempre seguir os padr√µes TypeScript
- Implementar tratamento de erro em cada fase  
- Testar em dispositivos reais (n√£o apenas simulador)
- Considerar limita√ß√µes de bateria e performance
- Documentar decis√µes arquiteturais importantes
- **Atualizar este roadmap** conforme progresso das fases